---
import type { PostMeta } from "@/lib/blog/types"
import { formatSubpostCount } from "@/lib/blog/utils"
import FormattedDate from "@/components/base/FormattedDate.astro"
import Icon from "@/components/base/Icon.astro"
import Link from "@/components/base/Link.astro"
import ReadingTime from "@/components/base/ReadingTime.astro"
import AuthorAvatar from "@/components/people/AuthorAvatar.astro"

interface Props extends PostMeta {
  variant?: "card" | "full"
  class?: string
}

const {
  authors,
  createdAt,
  updatedAt,
  wordCount,
  combinedWordCount,
  hasSubposts,
  subpostCount,
  variant = "full",
  class: className
} = Astro.props
const isCard = variant === "card"
---

<div
  id="post-metadata"
  class:list={[
    "text-muted-foreground flex items-center gap-x-3 gap-y-2 text-sm",
    isCard ? "meta-card flex-wrap" : "flex-col justify-center sm:flex-row",
    className
  ]}
>
  {
    authors.length > 0 && (
      <div class="flex items-center gap-1.5">
        {authors.map((author) => (
          <div class="flex items-center gap-1">
            <AuthorAvatar author={author} class="size-5" />
            {isCard ? (
              <span>{author.name}</span>
            ) : (
              <Link href={`/people/${author.id}`} underline class="text-foreground">
                {author.name}
              </Link>
            )}
          </div>
        ))}
      </div>
    )
  }

  <div class="flex items-center gap-1">
    <Icon name="publish" title="Published" />
    <FormattedDate date={createdAt} />
  </div>

  {
    updatedAt && (
      <div class="flex items-center gap-1">
        <Icon name="edit" title="Updated" />
        <FormattedDate date={updatedAt} />
      </div>
    )
  }

  {
    hasSubposts && subpostCount && (
      <div class="flex items-center gap-1">
        <Icon name="subposts" />
        <span>{formatSubpostCount(subpostCount)}</span>
      </div>
    )
  }

  {
    wordCount > 0 && (
      <div class="flex items-center gap-1">
        <Icon name="reading-time" />
        <ReadingTime
          wordCount={isCard && combinedWordCount ? combinedWordCount : wordCount}
          combinedWordCount={!isCard ? combinedWordCount : undefined}
        />
      </div>
    )
  }
</div>
<style>
  #post-metadata > *:not(:first-child)::before {
    content: none;
  }
  @media (min-width: 640px) {
    #post-metadata:not(.meta-card) > *:not(:first-child)::before {
      content: "â€¢";
      margin-inline: 0.25rem;
      display: inline-block;
      vertical-align: middle;
      color: color-mix(in oklch, var(--text-muted-foreground) 50%, transparent);
      pointer-events: none;
    }
  }
</style>
