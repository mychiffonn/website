---
import { tocUtils } from "@/lib/blog"
import type { TOCSection } from "@/lib/blog/types"
import { cn } from "@/lib/utils"
import TOCHeadingLink from "@/components/blog/TOCHeadingLink.astro"

interface Props {
  section: TOCSection
  currentPostId: string
  isSubpost: boolean
  parentId?: string
}

const { section, currentPostId, isSubpost, parentId } = Astro.props

const isActiveSection = section.subpostId === currentPostId
---

{
  section.type === "parent" ? (
    <div
      class={cn(
        "border-border/20 border-t border-b border-l-2 py-1 pl-2",
        !isSubpost ? "border-l-accent bg-accent/10" : "border-l-border/30"
      )}
    >
      <ul class="space-y-1" role="list">
        {section.headings.map((heading) => (
          <TOCHeadingLink
            heading={heading}
            href={tocUtils.getTOCUrl({ heading, isSubpost, parentId })}
            class={cn("text-foreground/70", tocUtils.getHeadingMargin(heading.depth))}
          />
        ))}
      </ul>
    </div>
  ) : (
    <div
      class={cn(
        "border-border/20 space-y-1 border-t border-b border-l-2 py-1 pl-2",
        isActiveSection ? "border-l-accent bg-accent/15" : "border-l-border/30"
      )}
    >
      <a
        href={tocUtils.getTOCUrl({ section, isActiveSection })}
        class={cn(
          "block rounded-md px-2 py-1.5 text-sm font-medium transition-colors",
          "hover:bg-accent/50 hover:text-accent-foreground",
          "focus-visible:ring-ring focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none",
          isActiveSection ? "text-foreground" : "text-foreground/70"
        )}
        data-heading-link={isActiveSection ? "top" : `${section.subpostId}-top`}
        aria-current={isActiveSection ? "page" : undefined}
      >
        {section.title}
      </a>
      {section.headings.length > 0 && (
        <ul class="ml-2 space-y-0.5" role="list">
          {section.headings.map((heading) => (
            <TOCHeadingLink
              heading={heading}
              href={tocUtils.getTOCUrl({ heading, section, isActiveSection })}
              class={cn(
                isActiveSection ? "text-foreground/70" : "text-foreground/40",
                tocUtils.getHeadingMargin(heading.depth)
              )}
            />
          ))}
        </ul>
      )}
    </div>
  )
}
