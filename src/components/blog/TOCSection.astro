---
import { getHeadingMargin } from "@/lib/blog/toc"
import type { TOCHeadingItem } from "@/lib/blog/types"
import { cn } from "@/lib/utils"
import Icon from "@/components/base/Icon.astro"
import TOCHeadingLink from "@/components/blog/TOCHeadingLink.astro"

interface Props {
  id: string
  title: string
  isActive: boolean
  headings: TOCHeadingItem[]
}

const { id, title, isActive, headings } = Astro.props
---

<details class={cn("border-border/20 border-t border-b py-1 group")} open={isActive}>
  <summary
    class={cn(
      "list-none cursor-pointer rounded-md px-1 py-1.5 text-sm font-medium transition-colors",
      "hover:bg-accent/50 hover:text-accent-foreground",
      "focus-visible:ring-ring focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none",
      "flex items-center gap-2",
      "text-foreground/70"
    )}
    data-heading-link={isActive ? "top" : `${id}-top`}
  >
    <span class="min-w-0 flex-1">
      {title}
    </span>
    {
      headings.length > 0 && (
        <Icon
          name="mingcute:down-line"
          class="text-muted-foreground shrink-0 transition-transform duration-200 group-open:rotate-180"
          aria-hidden="true"
        />
      )
    }
  </summary>
  {
    headings.length > 0 && (
      <div class="border-border/50 mt-1 border-l-2 pl-2">
        <ul class="space-y-0.5">
          {headings.map((heading) => (
            <TOCHeadingLink
              heading={heading}
              class={cn("text-foreground/70", getHeadingMargin(heading.depth))}
              data-heading-link={heading.slug}
            />
          ))}
        </ul>
      </div>
    )
  }
</details>
