---
import type { PostMeta } from "@/lib/blog/types"
import Icon from "@/components/base/Icon.astro"
import Link from "@/components/base/Link.astro"
import ReadingTime from "@/components/base/ReadingTime.astro"
import SubpostCountBadge from "@/components/blog/SubpostCountBadge.astro"

interface Props {
  post: PostMeta
  isActive: boolean
  isSubpost: boolean
}

const { post, isActive, isSubpost = false } = Astro.props

const actualWordCount = post.wordCount
const combinedWordCount = post.combinedWordCount
const subpostCount = post.subpostCount

const iconName = isActive ? "post-active" : isSubpost ? "subpost" : "parent-post"

const linkHref = `/blog/${post.id}`
---

{
  isActive ? (
    <div
      class:list={[
        "flex items-center gap-2 rounded-md px-2 py-2 text-sm",
        "bg-primary/40 text-primary-foreground font-medium"
      ]}
      aria-current="page"
    >
      <Icon
        name={iconName}
        class="text-primary mt-0.5 size-4 flex-shrink-0 self-start"
        aria-label={isSubpost ? "Current subpost" : "Current post"}
      />
      <div class="flex min-w-0 flex-col gap-0.5">
        <span class="text-foreground line-clamp-2 leading-tight font-medium">{post.title}</span>
        {subpostCount && !isSubpost && <SubpostCountBadge count={subpostCount} variant="full" />}
        {(actualWordCount > 0 || (subpostCount && !isSubpost)) && (
          <div class="text-muted-foreground flex items-center gap-2 text-xs">
            {actualWordCount > 0 && (
              <ReadingTime wordCount={actualWordCount} combinedWordCount={combinedWordCount} />
            )}
          </div>
        )}
      </div>
    </div>
  ) : (
    <Link
      href={linkHref}
      class:list={[
        "group/post flex items-center gap-2 rounded-md px-2 py-2 text-sm",
        "hover:bg-accent/50 transition-all duration-200",
        "focus-visible:ring-ring focus-visible:ring-2 focus-visible:ring-offset-2"
      ]}
    >
      <Icon
        name={iconName}
        class="text-muted-foreground group-hover/post:text-accent-foreground mt-0.5 size-4 flex-shrink-0 self-start transition-colors"
        aria-label={isSubpost ? "Subpost" : "Parent post"}
      />
      <div class="flex min-w-0 flex-col gap-0.5">
        <span
          class:list={[
            "text-muted-foreground line-clamp-2 font-medium",
            "group-hover/post:text-accent-foreground transition-colors"
          ]}
        >
          {post.title}
        </span>
        {(actualWordCount > 0 || (subpostCount && !isSubpost)) && (
          <div class="text-muted-foreground/60 group-hover/post:text-accent-foreground/50 flex items-center gap-2 text-xs transition-colors">
            {actualWordCount > 0 && (
              <ReadingTime wordCount={actualWordCount} combinedWordCount={combinedWordCount} />
            )}
            {subpostCount && !isSubpost && (
              <SubpostCountBadge count={subpostCount} variant="compact" />
            )}
          </div>
        )}
      </div>
    </Link>
  )
}
