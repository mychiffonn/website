---
import { PROFILE } from "@site-config"
import { getProjects } from "@/lib/projects"
import CommonLayout from "@/layouts/CommonLayout.astro"
import Section from "@/components/layout/Section.astro"
import { GithubActivity, ProjectCard } from "@/components/projects"

// Fetch and categorize projects in single operation
const allProjects = await getProjects()
const featuredProjects = allProjects.filter((project) => project.data.isHighlighted)
const otherProjects = allProjects.filter((project) => !project.data.isHighlighted)

// Get GitHub URL for GithubActivity
const githubUrl =
  (typeof PROFILE.links.github === "object" ? PROFILE.links.github?.href : PROFILE.links.github) ||
  "https://github.com"
---

<CommonLayout
  title="Projects"
  description="A collection of projects I've worked on, ranging from academic research to personal explorations. If you think it would be useful or interesting to collaborate on a project, please contact me to discuss."
  prose={false}
  breadcrumbs={[{ label: "Projects", icon: "folder-open" }]}
>
  <div class="flex flex-col gap-8">
    {/* Featured Projects */}
    {
      featuredProjects.length > 0 && (
        <Section title="Featured Projects">
          <div class="grid gap-4 md:grid-cols-1 lg:grid-cols-2">
            {featuredProjects.map((project) => (
              <ProjectCard {project} />
            ))}
          </div>
        </Section>
      )
    }

    {/* Other Projects */}
    {
      otherProjects.length > 0 && (
        <section>
          <h2 class="mb-4 text-2xl font-semibold">Other Projects</h2>
          <div class="grid gap-4 md:grid-cols-1 lg:grid-cols-2">
            {otherProjects.map((project) => (
              <ProjectCard {project} />
            ))}
          </div>
        </section>
      )
    }

    {/* GitHub Activity */}
    <GithubActivity githubUrl={githubUrl} />
  </div>
</CommonLayout>
